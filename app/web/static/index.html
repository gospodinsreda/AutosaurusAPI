<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autosaurus API ‚Äî –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
        :root{
            --bg-main:#0f0f0f;--bg-card:#1f1f1f;--bg-hover:#272727;--bg-input:#121212;
            --bg-header:#212121;--border:#303030;--text-primary:#f1f1f1;--text-secondary:#aaa;
            --accent:#ff0000;--accent-hover:#cc0000;--green:#2ea043;--green-hover:#238636;
            --blue:#3ea6ff;--orange:#f59e0b;--purple:#bf5af2;
        }
        body{font-family:'Roboto',sans-serif;background:var(--bg-main);color:var(--text-primary);min-height:100vh;display:flex;flex-direction:column}
        a{color:var(--blue);text-decoration:none}

        /* Layout */
        .app-header{background:var(--bg-header);border-bottom:1px solid var(--border);height:56px;display:flex;align-items:center;padding:0 16px;position:fixed;top:0;left:0;right:0;z-index:100}
        .app-header .logo{display:flex;align-items:center;gap:10px;font-size:18px;font-weight:700;white-space:nowrap}
        .app-header .logo span.dino{font-size:26px}
        .app-header .health-dot{width:10px;height:10px;border-radius:50%;background:#555;margin-left:auto;flex-shrink:0}
        .app-header .health-dot.ok{background:var(--green)}
        .app-header .health-dot.err{background:var(--accent)}

        .app-body{display:flex;margin-top:56px;min-height:calc(100vh - 56px)}

        /* Sidebar */
        .sidebar{width:220px;background:var(--bg-main);border-right:1px solid var(--border);position:fixed;top:56px;bottom:0;overflow-y:auto;z-index:90;padding:8px 0}
        .sidebar .nav-item{display:flex;align-items:center;gap:12px;padding:10px 20px;cursor:pointer;border-radius:10px;margin:2px 8px;font-size:14px;color:var(--text-primary);transition:background .15s}
        .sidebar .nav-item:hover{background:var(--bg-hover)}
        .sidebar .nav-item.active{background:var(--bg-hover);font-weight:500}
        .sidebar .nav-item .icon{width:24px;text-align:center;font-size:18px;flex-shrink:0}

        .main-content{margin-left:220px;flex:1;padding:24px;max-width:1200px;width:100%}

        /* Sections */
        .section{display:none}
        .section.active{display:block}

        /* Cards */
        .card{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:16px}
        .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
        .card-header h2{font-size:20px;font-weight:700}

        /* Buttons */
        .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border:none;border-radius:8px;font-family:inherit;font-size:13px;font-weight:500;cursor:pointer;transition:background .15s,opacity .15s;white-space:nowrap}
        .btn:disabled{opacity:.5;cursor:not-allowed}
        .btn-primary{background:var(--accent);color:#fff}
        .btn-primary:hover:not(:disabled){background:var(--accent-hover)}
        .btn-secondary{background:var(--bg-hover);color:var(--text-primary);border:1px solid var(--border)}
        .btn-secondary:hover:not(:disabled){background:#333}
        .btn-success{background:var(--green);color:#fff}
        .btn-success:hover:not(:disabled){background:var(--green-hover)}
        .btn-danger{background:#b91c1c;color:#fff}
        .btn-danger:hover:not(:disabled){background:#991b1b}
        .btn-sm{padding:5px 12px;font-size:12px}

        /* Chips / pills */
        .chips{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px}
        .chip{padding:6px 14px;border-radius:20px;background:var(--bg-hover);border:1px solid var(--border);font-size:13px;cursor:pointer;transition:background .15s}
        .chip:hover{background:#333}
        .chip.active{background:var(--text-primary);color:var(--bg-main);border-color:var(--text-primary);font-weight:500}

        /* Form elements */
        .form-group{margin-bottom:14px}
        .form-label{display:block;font-size:13px;font-weight:500;color:var(--text-secondary);margin-bottom:6px}
        .form-input,.form-select,.form-textarea{width:100%;padding:10px 12px;background:var(--bg-input);border:1px solid var(--border);border-radius:8px;color:var(--text-primary);font-family:inherit;font-size:14px;transition:border-color .15s}
        .form-input:focus,.form-select:focus,.form-textarea:focus{outline:none;border-color:var(--blue)}
        .form-textarea{resize:vertical;min-height:60px}
        .form-input::placeholder,.form-textarea::placeholder{color:#555}
        .form-select option{background:var(--bg-card);color:var(--text-primary)}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        .form-check{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:14px}
        .form-check input[type="checkbox"]{width:18px;height:18px;accent-color:var(--accent);cursor:pointer}

        /* Slider */
        input[type="range"]{-webkit-appearance:none;width:100%;height:4px;background:var(--border);border-radius:2px;outline:none}
        input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;background:var(--accent);border-radius:50%;cursor:pointer}
        .range-row{display:flex;align-items:center;gap:12px}
        .range-val{font-size:16px;font-weight:700;min-width:32px;text-align:right}

        /* Session card */
        .session-card{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;background:var(--bg-card);border:1px solid var(--border);border-radius:10px;margin-bottom:8px;transition:background .15s}
        .session-card:hover{background:var(--bg-hover)}
        .session-card .info h3{font-size:15px;font-weight:500}
        .session-card .info p{font-size:12px;color:var(--text-secondary);margin-top:2px}
        .session-card .actions{display:flex;gap:6px}
        .status-badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:11px;font-weight:500;text-transform:uppercase}
        .status-active{background:rgba(46,160,67,.2);color:#3fb950}
        .status-idle{background:rgba(245,158,11,.2);color:#f59e0b}
        .status-closed{background:rgba(255,0,0,.15);color:#ff4444}

        /* Result box */
        .result-box{background:var(--bg-input);border:1px solid var(--border);border-radius:8px;padding:16px;max-height:400px;overflow:auto;white-space:pre-wrap;word-break:break-word;font-family:'Roboto Mono',monospace;font-size:13px;color:#e6e6e6;line-height:1.5}

        /* Toast */
        .toast-container{position:fixed;top:68px;right:16px;z-index:9999;display:flex;flex-direction:column;gap:8px}
        .toast{padding:12px 20px;border-radius:8px;font-size:14px;font-weight:500;color:#fff;box-shadow:0 4px 12px rgba(0,0,0,.4);opacity:0;transform:translateX(40px);transition:all .3s ease}
        .toast.show{opacity:1;transform:translateX(0)}
        .toast.success{background:var(--green)}
        .toast.error{background:#b91c1c}
        .toast.info{background:#1e40af}

        /* Warning banner */
        .banner{padding:12px 16px;border-radius:8px;font-size:13px;margin-bottom:16px;display:flex;align-items:flex-start;gap:10px}
        .banner-warn{background:rgba(245,158,11,.12);border:1px solid rgba(245,158,11,.3);color:#f59e0b}
        .banner-info{background:rgba(62,166,255,.1);border:1px solid rgba(62,166,255,.25);color:var(--blue)}

        /* Script list items */
        .script-item{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:var(--bg-main);border:1px solid var(--border);border-radius:8px;margin-bottom:6px;transition:background .15s}
        .script-item:hover{background:var(--bg-hover)}
        .script-item .meta{flex:1;min-width:0}
        .script-item .meta h4{font-size:14px;font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
        .script-item .meta p{font-size:11px;color:var(--text-secondary);margin-top:2px}
        .script-item .btns{display:flex;gap:4px;flex-shrink:0;margin-left:10px}

        /* AI conversation */
        .msg-bubble{padding:10px 14px;border-radius:8px;margin-bottom:8px;font-size:13px;line-height:1.5;border-left:3px solid transparent}
        .msg-user{background:rgba(62,166,255,.08);border-left-color:var(--blue)}
        .msg-assistant{background:rgba(46,160,67,.08);border-left-color:var(--green)}
        .msg-role{font-size:11px;font-weight:700;text-transform:uppercase;margin-bottom:4px;color:var(--text-secondary)}

        /* Modal */
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:200}
        .modal-overlay.open{display:flex}
        .modal{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:24px;max-width:600px;width:90%;max-height:80vh;overflow:auto}
        .modal h3{font-size:18px;font-weight:700;margin-bottom:16px}

        /* Utility */
        .hidden{display:none!important}
        .mt-4{margin-top:16px}
        .mb-4{margin-bottom:16px}
        .text-center{text-align:center}
        .text-muted{color:var(--text-secondary);font-size:13px}
        .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
        .empty-state{text-align:center;padding:40px 20px;color:var(--text-secondary)}
        .empty-state .icon{font-size:40px;margin-bottom:12px}
        .empty-state p{font-size:14px}

        /* Scrollbar */
        ::-webkit-scrollbar{width:8px;height:8px}
        ::-webkit-scrollbar-track{background:transparent}
        ::-webkit-scrollbar-thumb{background:#333;border-radius:4px}
        ::-webkit-scrollbar-thumb:hover{background:#444}

        /* Responsive */
        @media(max-width:768px){
            .sidebar{width:64px;padding:8px 0}
            .sidebar .nav-item{padding:10px 0;justify-content:center;margin:2px 4px}
            .sidebar .nav-item span:not(.icon){display:none}
            .main-content{margin-left:64px;padding:16px}
            .form-row{grid-template-columns:1fr}
            .grid-2{grid-template-columns:1fr}
            .session-card{flex-direction:column;align-items:flex-start;gap:10px}
            .session-card .actions{width:100%;flex-wrap:wrap}
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="logo">
            <span class="dino">ü¶ï</span>
            <span>Autosaurus API</span>
        </div>
        <div class="health-dot" id="health-dot" title="–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è..."></div>
    </header>

    <div class="app-body">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="nav-item active" data-section="sessions">
                <span class="icon">üìã</span><span>–°–µ—Å—Å–∏–∏</span>
            </div>
            <div class="nav-item" data-section="actions">
                <span class="icon">‚ö°</span><span>–î–µ–π—Å—Ç–≤–∏—è</span>
            </div>
            <div class="nav-item" data-section="scripts">
                <span class="icon">üìù</span><span>–°–∫—Ä–∏–ø—Ç—ã</span>
            </div>
            <div class="nav-item" data-section="ai-agent">
                <span class="icon">ü§ñ</span><span>AI –ê–≥–µ–Ω—Ç</span>
            </div>
            <div class="nav-item" data-section="settings">
                <span class="icon">‚öôÔ∏è</span><span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">

            <!-- ========== SESSIONS ========== -->
            <div id="sessions" class="section active">
                <div class="card">
                    <div class="card-header">
                        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏</h2>
                        <div style="display:flex;gap:8px">
                            <button class="btn btn-primary" onclick="showCreateSessionForm()">Ôºã –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é</button>
                            <button class="btn btn-danger btn-sm" onclick="closeAllSessions()">–ó–∞–∫—Ä—ã—Ç—å –≤—Å–µ</button>
                        </div>
                    </div>

                    <!-- Create Session Form -->
                    <div id="create-session-form" class="card hidden" style="background:var(--bg-main)">
                        <h3 style="font-size:16px;font-weight:600;margin-bottom:14px">–ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">–ò–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                <input type="text" id="session-name" class="form-input" placeholder="–ú–æ—è —Å–µ—Å—Å–∏—è">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–Ø–∑—ã–∫</label>
                                <input type="text" id="session-lang" class="form-input" value="ru" placeholder="ru">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">–†–∞–∑–º–µ—Ä –æ–∫–Ω–∞</label>
                                <input type="text" id="session-window-size" class="form-input" value="1920x1080" placeholder="1920x1080">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ü—Ä–æ–∫—Å–∏</label>
                                <input type="text" id="session-proxy" class="form-input" placeholder="http://user:pass@host:port">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">User-Agent</label>
                                <input type="text" id="session-user-agent" class="form-input" placeholder="–ê–≤—Ç–æ">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ü—Ä–æ—Ñ–∏–ª—å</label>
                                <input type="text" id="session-profile" class="form-input" placeholder="–ò–º—è –ø—Ä–æ—Ñ–∏–ª—è">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Timeout (—Å–µ–∫)</label>
                                <input type="number" id="session-timeout" class="form-input" value="30">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–§–∞–π–ª cookies</label>
                                <input type="text" id="session-cookies-file" class="form-input" placeholder="path/to/cookies.txt">
                            </div>
                        </div>
                        <div style="display:flex;flex-wrap:wrap;gap:16px;margin:12px 0">
                            <label class="form-check"><input type="checkbox" id="session-headless"> Headless</label>
                            <label class="form-check"><input type="checkbox" id="session-bypass-cf" checked> Bypass Cloudflare</label>
                            <label class="form-check"><input type="checkbox" id="session-block-images"> –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                            <label class="form-check"><input type="checkbox" id="session-block-images-css"> –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ CSS</label>
                            <label class="form-check"><input type="checkbox" id="session-tiny-profile" checked> Tiny Profile</label>
                            <label class="form-check"><input type="checkbox" id="session-human-mode" checked> –ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º</label>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                            <input type="text" id="session-add-args" class="form-input" placeholder="--disable-gpu, --no-sandbox">
                        </div>
                        <div style="display:flex;gap:8px;margin-top:8px">
                            <button class="btn btn-success" onclick="createSession()">–°–æ–∑–¥–∞—Ç—å</button>
                            <button class="btn btn-secondary" onclick="hideCreateSessionForm()">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </div>

                    <div id="sessions-list"></div>
                </div>
            </div>

            <!-- ========== ACTIONS ========== -->
            <div id="actions" class="section">
                <div class="card">
                    <div class="card-header"><h2>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π</h2></div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–°–µ—Å—Å–∏—è</label>
                            <select id="action-session" class="form-select"><option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Å—Å–∏—é...</option></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–î–µ–π—Å—Ç–≤–∏–µ</label>
                            <select id="action-type" class="form-select" onchange="showActionForm()">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ...</option>
                                <optgroup label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
                                    <option value="navigate">navigate ‚Äî –ü–µ—Ä–µ–π—Ç–∏ –ø–æ URL</option>
                                    <option value="google_get">google_get ‚Äî Google –ø–æ–∏—Å–∫</option>
                                    <option value="get_via">get_via ‚Äî –ü–µ—Ä–µ–π—Ç–∏ —á–µ—Ä–µ–∑</option>
                                    <option value="back">back ‚Äî –ù–∞–∑–∞–¥</option>
                                    <option value="forward">forward ‚Äî –í–ø–µ—Ä—ë–¥</option>
                                    <option value="refresh">refresh ‚Äî –û–±–Ω–æ–≤–∏—Ç—å</option>
                                </optgroup>
                                <optgroup label="–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ">
                                    <option value="click">click ‚Äî –ö–ª–∏–∫</option>
                                    <option value="type">type ‚Äî –í–≤–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç</option>
                                    <option value="clear">clear ‚Äî –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ</option>
                                    <option value="select_option">select_option ‚Äî –í—ã–±—Ä–∞—Ç—å –æ–ø—Ü–∏—é</option>
                                    <option value="scroll">scroll ‚Äî –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å</option>
                                    <option value="scroll_into_view">scroll_into_view ‚Äî –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —ç–ª–µ–º–µ–Ω—Ç—É</option>
                                    <option value="hover">hover ‚Äî –ù–∞–≤–µ—Å—Ç–∏ –∫—É—Ä—Å–æ—Ä</option>
                                    <option value="focus">focus ‚Äî –§–æ–∫—É—Å</option>
                                    <option value="drag_and_drop">drag_and_drop ‚Äî –ü–µ—Ä–µ—Ç–∞—â–∏—Ç—å</option>
                                </optgroup>
                                <optgroup label="–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö">
                                    <option value="get_text">get_text ‚Äî –¢–µ–∫—Å—Ç —ç–ª–µ–º–µ–Ω—Ç–∞</option>
                                    <option value="get_attribute">get_attribute ‚Äî –ê—Ç—Ä–∏–±—É—Ç</option>
                                    <option value="get_html">get_html ‚Äî HTML —ç–ª–µ–º–µ–Ω—Ç–∞</option>
                                    <option value="get_page_html">get_page_html ‚Äî HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã</option>
                                    <option value="get_page_text">get_page_text ‚Äî –¢–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã</option>
                                    <option value="get_url">get_url ‚Äî URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã</option>
                                    <option value="get_title">get_title ‚Äî –ó–∞–≥–æ–ª–æ–≤–æ–∫</option>
                                    <option value="get_cookies">get_cookies ‚Äî Cookies</option>
                                    <option value="is_element_present">is_element_present ‚Äî –≠–ª–µ–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?</option>
                                </optgroup>
                                <optgroup label="–ü–∞—Ä—Å–∏–Ω–≥">
                                    <option value="soupify">soupify ‚Äî –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</option>
                                    <option value="soupify_select">soupify_select ‚Äî –í—ã–±—Ä–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç</option>
                                    <option value="soupify_select_all">soupify_select_all ‚Äî –í—ã–±—Ä–∞—Ç—å –≤—Å–µ</option>
                                </optgroup>
                                <optgroup label="JavaScript / CDP">
                                    <option value="run_js">run_js ‚Äî –í—ã–ø–æ–ª–Ω–∏—Ç—å JS</option>
                                    <option value="run_cdp">run_cdp ‚Äî –í—ã–ø–æ–ª–Ω–∏—Ç—å CDP</option>
                                </optgroup>
                                <optgroup label="Cookies">
                                    <option value="set_cookies">set_cookies ‚Äî –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å cookies</option>
                                    <option value="delete_cookies">delete_cookies ‚Äî –£–¥–∞–ª–∏—Ç—å cookies</option>
                                    <option value="load_cookies_netscape">load_cookies_netscape ‚Äî –ó–∞–≥—Ä—É–∑–∏—Ç—å Netscape</option>
                                </optgroup>
                                <optgroup label="–°–∫—Ä–∏–Ω—à–æ—Ç—ã">
                                    <option value="screenshot">screenshot ‚Äî –°–∫—Ä–∏–Ω—à–æ—Ç</option>
                                    <option value="screenshot_element">screenshot_element ‚Äî –°–∫—Ä–∏–Ω—à–æ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞</option>
                                </optgroup>
                                <optgroup label="–í–∫–ª–∞–¥–∫–∏">
                                    <option value="new_tab">new_tab ‚Äî –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞</option>
                                    <option value="switch_tab">switch_tab ‚Äî –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∫–ª–∞–¥–∫—É</option>
                                    <option value="close_tab">close_tab ‚Äî –ó–∞–∫—Ä—ã—Ç—å –≤–∫–ª–∞–¥–∫—É</option>
                                    <option value="get_tabs">get_tabs ‚Äî –°–ø–∏—Å–æ–∫ –≤–∫–ª–∞–¥–æ–∫</option>
                                </optgroup>
                                <optgroup label="iFrames">
                                    <option value="select_iframe">select_iframe ‚Äî –í—ã–±—Ä–∞—Ç—å iframe</option>
                                    <option value="get_iframe_by_link">get_iframe_by_link ‚Äî Iframe –ø–æ —Å—Å—ã–ª–∫–µ</option>
                                    <option value="exit_iframe">exit_iframe ‚Äî –í—ã–π—Ç–∏ –∏–∑ iframe</option>
                                </optgroup>
                                <optgroup label="–û–∂–∏–¥–∞–Ω–∏–µ">
                                    <option value="sleep">sleep ‚Äî –ü–∞—É–∑–∞</option>
                                    <option value="random_sleep">random_sleep ‚Äî –°–ª—É—á–∞–π–Ω–∞—è –ø–∞—É–∑–∞</option>
                                    <option value="wait_for_navigation">wait_for_navigation ‚Äî –ñ–¥–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é</option>
                                    <option value="wait_for_element">wait_for_element ‚Äî –ñ–¥–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç</option>
                                </optgroup>
                                <optgroup label="–ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º">
                                    <option value="enable_human_mode">enable_human_mode ‚Äî –í–∫–ª—é—á–∏—Ç—å</option>
                                    <option value="disable_human_mode">disable_human_mode ‚Äî –í—ã–∫–ª—é—á–∏—Ç—å</option>
                                </optgroup>
                                <optgroup label="Fetch –∑–∞–ø—Ä–æ—Å—ã">
                                    <option value="fetch_get">fetch_get ‚Äî GET –∑–∞–ø—Ä–æ—Å</option>
                                    <option value="fetch_post">fetch_post ‚Äî POST –∑–∞–ø—Ä–æ—Å</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>

                    <div id="action-forms" class="card" style="background:var(--bg-main)">
                        <p class="text-muted text-center">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ä–º—ã</p>
                    </div>

                    <button class="btn btn-success" onclick="executeAction()" style="margin-top:8px">‚ñ∂ –í—ã–ø–æ–ª–Ω–∏—Ç—å</button>

                    <div id="action-result" class="hidden mt-4">
                        <h3 style="font-size:15px;font-weight:600;margin-bottom:8px">–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
                        <pre id="action-result-content" class="result-box"></pre>
                    </div>
                </div>
            </div>

            <!-- ========== SCRIPTS ========== -->
            <div id="scripts" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞–º–∏</h2>
                        <button class="btn btn-primary" onclick="showNewScriptForm()">Ôºã –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç</button>
                    </div>

                    <div class="grid-2">
                        <div>
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                                <h3 style="font-size:16px;font-weight:600">–†–µ–¥–∞–∫—Ç–æ—Ä —Å–∫—Ä–∏–ø—Ç–∞</h3>
                                <select id="script-session" class="form-select" style="width:auto;min-width:180px"><option value="">–°–µ—Å—Å–∏—è...</option></select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞</label>
                                <input type="text" id="script-name" class="form-input" placeholder="–ú–æ–π —Å–∫—Ä–∏–ø—Ç">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                <input type="text" id="script-description" class="form-input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–®–∞–≥–∏ —Å–∫—Ä–∏–ø—Ç–∞ (JSON)</label>
                                <textarea id="script-editor" class="form-textarea" style="min-height:320px;font-family:'Roboto Mono',monospace;font-size:13px" placeholder='[
  {
    "action": "navigate",
    "url": "https://example.com"
  },
  {
    "action": "click",
    "selector": "#button"
  }
]'></textarea>
                            </div>
                            <div style="display:flex;gap:8px">
                                <button class="btn btn-success" onclick="runScript()">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                                <button class="btn btn-primary" onclick="saveScript()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                <button class="btn btn-secondary" onclick="clearScriptEditor()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                            </div>
                        </div>
                        <div>
                            <h3 style="font-size:16px;font-weight:600;margin-bottom:12px">–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã</h3>
                            <div id="saved-scripts" style="max-height:500px;overflow:auto"></div>
                        </div>
                    </div>

                    <div id="script-result" class="hidden mt-4">
                        <h3 style="font-size:15px;font-weight:600;margin-bottom:8px">–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</h3>
                        <pre id="script-result-content" class="result-box"></pre>
                    </div>
                </div>
            </div>

            <!-- ========== AI AGENT ========== -->
            <div id="ai-agent" class="section">
                <div class="card">
                    <div class="card-header"><h2>ü§ñ AI –ê–≥–µ–Ω—Ç</h2></div>

                    <div class="banner banner-warn">
                        <span>‚ö†Ô∏è</span>
                        <span><strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ AI –º–æ–¥–µ–ª—å –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏¬ª –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º.</span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–°–µ—Å—Å–∏—è</label>
                            <select id="ai-session" class="form-select"><option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Å—Å–∏—é...</option></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ú–∞–∫—Å–∏–º—É–º —à–∞–≥–æ–≤</label>
                            <div class="range-row">
                                <input type="range" id="ai-max-steps" min="1" max="50" value="15">
                                <span class="range-val" id="ai-max-steps-value">15</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–¶–µ–ª—å (—á—Ç–æ –¥–æ–ª–∂–µ–Ω —Å–¥–µ–ª–∞—Ç—å –∞–≥–µ–Ω—Ç)</label>
                        <textarea id="ai-goal" class="form-textarea" rows="4" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Python –Ω–∞ Wikipedia –∏ —Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç"></textarea>
                    </div>

                    <button class="btn btn-primary" onclick="runAIAgent()" style="background:var(--purple)">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å AI –ê–≥–µ–Ω—Ç–∞</button>

                    <div id="ai-output" class="mt-4">
                        <div id="ai-conversation" class="hidden mb-4">
                            <h3 style="font-size:15px;font-weight:600;margin-bottom:8px">üí¨ –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞</h3>
                            <div id="ai-conversation-content" style="max-height:400px;overflow:auto"></div>
                        </div>
                        <div id="ai-transcript" class="hidden mb-4">
                            <h3 style="font-size:15px;font-weight:600;margin-bottom:8px">üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                            <div id="ai-transcript-content" style="max-height:300px;overflow:auto"></div>
                        </div>
                        <div id="ai-final-result" class="hidden">
                            <h3 style="font-size:15px;font-weight:600;margin-bottom:8px">‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h3>
                            <pre id="ai-final-result-content" class="result-box"></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========== SETTINGS ========== -->
            <div id="settings" class="section">
                <div class="card">
                    <div class="card-header"><h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ AI</h2></div>

                    <div class="banner banner-info">
                        <span>üí°</span>
                        <span><strong>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ LM Studio –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –º–æ–¥–µ–ª–µ–π. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –≤ LM Studio –∏ —É–∫–∞–∂–∏—Ç–µ endpoint (–æ–±—ã—á–Ω–æ http://localhost:1234/v1).</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">AI Endpoint</label>
                        <input type="text" id="ai-endpoint" class="form-input" value="http://localhost:1234/v1" placeholder="http://localhost:1234/v1">
                    </div>

                    <div class="form-group">
                        <label class="form-label">API Key (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="password" id="ai-api-key" class="form-input" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π">
                    </div>

                    <div style="margin-bottom:14px">
                        <button class="btn btn-secondary" onclick="fetchModels()">üîÑ –ü–æ–ª—É—á–∏—Ç—å –º–æ–¥–µ–ª–∏</button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">–ú–æ–¥–µ–ª—å</label>
                        <select id="ai-model" class="form-select">
                            <option value="">–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-check"><input type="checkbox" id="ai-enabled" checked> –í–∫–ª—é—á–∏—Ç—å AI –∞–≥–µ–Ω—Ç–∞</label>
                    </div>

                    <div style="display:flex;gap:8px;margin-top:16px">
                        <button class="btn btn-success" onclick="saveAISettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    </div>

                    <div id="settings-status" class="hidden mt-4" style="padding:10px 14px;border-radius:8px;font-size:13px"></div>
                </div>
            </div>

        </main>
    </div>

    <!-- Session Info Modal -->
    <div class="modal-overlay" id="session-modal">
        <div class="modal">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏–∏</h3>
            <pre id="session-modal-content" class="result-box"></pre>
            <button class="btn btn-secondary mt-4" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- Toast container -->
    <div class="toast-container" id="toast-container"></div>

    <script>
        // ============ CONFIG ============
        const API = window.location.origin + '/api';

        // ============ STATE ============
        let sessions = [];
        let serverScripts = [];
        let currentEditScriptId = null;

        // ============ INIT ============
        document.addEventListener('DOMContentLoaded', () => {
            setupNavigation();
            setupSliders();
            checkHealth();
            loadSessions();
            loadServerScripts();
            loadAISettings();
        });

        // ============ NAVIGATION ============
        function setupNavigation() {
            document.querySelectorAll('.sidebar .nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const sec = item.dataset.section;
                    document.querySelectorAll('.sidebar .nav-item').forEach(n => n.classList.remove('active'));
                    item.classList.add('active');
                    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                    document.getElementById(sec).classList.add('active');
                });
            });
        }

        // ============ SLIDERS ============
        function setupSliders() {
            const ms = document.getElementById('ai-max-steps');
            const msv = document.getElementById('ai-max-steps-value');
            ms.addEventListener('input', () => msv.textContent = ms.value);
        }

        // ============ HEALTH ============
        async function checkHealth() {
            try {
                const r = await fetch(window.location.origin + '/health');
                if (r.ok) {
                    document.getElementById('health-dot').classList.add('ok');
                    document.getElementById('health-dot').title = '–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç';
                } else {
                    document.getElementById('health-dot').classList.add('err');
                    document.getElementById('health-dot').title = '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞';
                }
            } catch {
                document.getElementById('health-dot').classList.add('err');
                document.getElementById('health-dot').title = '–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
            }
        }

        // ============ NOTIFICATIONS ============
        function showNotification(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            requestAnimationFrame(() => toast.classList.add('show'));
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 3500);
        }

        // ============ MODAL ============
        function closeModal() {
            document.getElementById('session-modal').classList.remove('open');
        }

        // ============ SESSIONS ============
        async function loadSessions() {
            try {
                const r = await fetch(`${API}/sessions`);
                const data = await r.json();
                sessions = data.sessions || [];
                renderSessions();
                updateSessionDropdowns();
            } catch (e) {
                console.error('Error loading sessions:', e);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Å—Å–∏–π', 'error');
            }
        }

        function renderSessions() {
            const c = document.getElementById('sessions-list');
            if (!sessions.length) {
                c.innerHTML = '<div class="empty-state"><div class="icon">üì≠</div><p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã.</p></div>';
                return;
            }
            c.innerHTML = sessions.map(s => {
                const st = s.status || 'active';
                const badgeCls = st === 'active' ? 'status-active' : st === 'idle' ? 'status-idle' : 'status-closed';
                return `<div class="session-card">
                    <div class="info">
                        <h3>${s.name || s.session_id} <span class="status-badge ${badgeCls}">${st}</span></h3>
                        <p>ID: ${s.session_id} ¬∑ URL: ${s.current_url || '‚Äî'}</p>
                        <p>–°–æ–∑–¥–∞–Ω–∞: ${new Date(s.created_at).toLocaleString('ru-RU')}</p>
                    </div>
                    <div class="actions">
                        <button class="btn btn-secondary btn-sm" onclick="viewSession('${s.session_id}')">üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                        <button class="btn btn-secondary btn-sm" onclick="closeSession('${s.session_id}')">‚è∏ –ó–∞–∫—Ä—ã—Ç—å</button>
                        <button class="btn btn-danger btn-sm" onclick="removeSession('${s.session_id}')">üóë –£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>`;
            }).join('');
        }

        function updateSessionDropdowns() {
            ['action-session', 'script-session', 'ai-session'].forEach(id => {
                const sel = document.getElementById(id);
                const prev = sel.value;
                sel.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Å—Å–∏—é...</option>' +
                    sessions.map(s => `<option value="${s.session_id}">${s.name || s.session_id}</option>`).join('');
                if (prev && sessions.some(s => s.session_id === prev)) sel.value = prev;
            });
        }

        function showCreateSessionForm() { document.getElementById('create-session-form').classList.remove('hidden'); }
        function hideCreateSessionForm() { document.getElementById('create-session-form').classList.add('hidden'); }

        async function createSession() {
            const addArgsRaw = document.getElementById('session-add-args').value.trim();
            const addArgs = addArgsRaw ? addArgsRaw.split(',').map(a => a.trim()).filter(Boolean) : [];

            const config = {
                headless: document.getElementById('session-headless').checked,
                bypass_cloudflare: document.getElementById('session-bypass-cf').checked,
                block_images: document.getElementById('session-block-images').checked,
                block_images_and_css: document.getElementById('session-block-images-css').checked,
                tiny_profile: document.getElementById('session-tiny-profile').checked,
                human_mode: document.getElementById('session-human-mode').checked,
                window_size: document.getElementById('session-window-size').value || '1920x1080',
                lang: document.getElementById('session-lang').value || 'ru',
                timeout: parseInt(document.getElementById('session-timeout').value) || 30,
                add_arguments: addArgs
            };
            const proxy = document.getElementById('session-proxy').value.trim();
            if (proxy) config.proxy = proxy;
            const ua = document.getElementById('session-user-agent').value.trim();
            if (ua) config.user_agent = ua;
            const profile = document.getElementById('session-profile').value.trim();
            if (profile) config.profile = profile;
            const cookiesFile = document.getElementById('session-cookies-file').value.trim();
            if (cookiesFile) config.cookies_file = cookiesFile;

            const body = { config };
            const name = document.getElementById('session-name').value.trim();
            if (name) body.name = name;

            try {
                const r = await fetch(`${API}/sessions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                if (r.ok) {
                    showNotification('–°–µ—Å—Å–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!', 'success');
                    hideCreateSessionForm();
                    await loadSessions();
                } else {
                    const err = await r.json();
                    showNotification('–û—à–∏–±–∫–∞: ' + (err.detail || JSON.stringify(err)), 'error');
                }
            } catch (e) {
                console.error('Error creating session:', e);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏', 'error');
            }
        }

        async function viewSession(sessionId) {
            try {
                const r = await fetch(`${API}/sessions/${sessionId}`);
                const data = await r.json();
                document.getElementById('session-modal-content').textContent = JSON.stringify(data, null, 2);
                document.getElementById('session-modal').classList.add('open');
            } catch (e) {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–µ—Å—Å–∏–∏', 'error');
            }
        }

        async function closeSession(sessionId) {
            if (!confirm('–ó–∞–∫—Ä—ã—Ç—å —ç—Ç—É —Å–µ—Å—Å–∏—é?')) return;
            try {
                const r = await fetch(`${API}/sessions/${sessionId}`, { method: 'DELETE' });
                if (r.ok) { showNotification('–°–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞', 'success'); await loadSessions(); }
                else showNotification('–û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏', 'error');
            } catch { showNotification('–û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏', 'error'); }
        }

        async function removeSession(sessionId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å–µ—Å—Å–∏—é?')) return;
            try {
                const r = await fetch(`${API}/sessions/${sessionId}/remove`, { method: 'DELETE' });
                if (r.ok) { showNotification('–°–µ—Å—Å–∏—è —É–¥–∞–ª–µ–Ω–∞', 'success'); await loadSessions(); }
                else showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏', 'error');
            } catch { showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏', 'error'); }
        }

        async function closeAllSessions() {
            if (!confirm('–ó–∞–∫—Ä—ã—Ç—å –í–°–ï —Å–µ—Å—Å–∏–∏?')) return;
            try {
                const r = await fetch(`${API}/sessions/close-all`, { method: 'POST' });
                if (r.ok) { showNotification('–í—Å–µ —Å–µ—Å—Å–∏–∏ –∑–∞–∫—Ä—ã—Ç—ã', 'success'); await loadSessions(); }
                else showNotification('–û—à–∏–±–∫–∞', 'error');
            } catch { showNotification('–û—à–∏–±–∫–∞', 'error'); }
        }

        // ============ ACTIONS ============
        function showActionForm() {
            const at = document.getElementById('action-type').value;
            const c = document.getElementById('action-forms');
            if (!at) { c.innerHTML = '<p class="text-muted text-center">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ä–º—ã</p>'; return; }

            const inp = (id, label, placeholder, type) =>
                `<div class="form-group"><label class="form-label">${label}</label>` +
                (type === 'textarea'
                    ? `<textarea id="param-${id}" class="form-textarea" style="font-family:'Roboto Mono',monospace;font-size:13px;min-height:120px" placeholder="${placeholder||''}"></textarea>`
                    : `<input type="${type||'text'}" id="param-${id}" class="form-input" placeholder="${placeholder||''}"${type==='number'?' value="0"':''}>`) +
                `</div>`;

            const forms = {
                navigate: inp('url','URL','https://example.com'),
                google_get: inp('url','–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å','Python tutorial'),
                get_via: inp('url','URL','https://example.com'),
                click: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä','#button, .class, xpath=//button'),
                type: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä','#input') + inp('text','–¢–µ–∫—Å—Ç','–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç'),
                clear: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä','#input'),
                select_option: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä','select#my-select') + inp('value','–ó–Ω–∞—á–µ–Ω–∏–µ','option-value'),
                scroll: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)',''),
                scroll_into_view: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä','#element'),
                hover: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä','#element'),
                focus: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä','#element'),
                drag_and_drop: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞','#source') + inp('value','–°–µ–ª–µ–∫—Ç–æ—Ä —Ü–µ–ª–∏','#target'),
                get_text: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä','#element'),
                get_attribute: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä','#element') + inp('attribute','–ê—Ç—Ä–∏–±—É—Ç','href, class, id'),
                get_html: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä','#element'),
                is_element_present: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä','#element'),
                soupify_select: inp('selector','CSS —Å–µ–ª–µ–∫—Ç–æ—Ä','div.content'),
                soupify_select_all: inp('selector','CSS —Å–µ–ª–µ–∫—Ç–æ—Ä','div.item'),
                run_js: inp('script','JavaScript –∫–æ–¥','return document.title;','textarea'),
                run_cdp: inp('script','CDP –∫–æ–º–∞–Ω–¥–∞','','textarea'),
                set_cookies: inp('cookies','Cookies (JSON)','[{"name":"test","value":"123"}]','textarea'),
                load_cookies_netscape: inp('cookies_text','Cookies (Netscape —Ñ–æ—Ä–º–∞—Ç)','','textarea'),
                screenshot: inp('save_as','–ò–º—è —Ñ–∞–π–ª–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)','screenshot.png'),
                screenshot_element: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä','#element') + inp('save_as','–ò–º—è —Ñ–∞–π–ª–∞','element.png'),
                new_tab: inp('url','URL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)','https://example.com'),
                switch_tab: inp('tab_index','–ò–Ω–¥–µ–∫—Å –≤–∫–ª–∞–¥–∫–∏','0','number'),
                select_iframe: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä iframe','iframe#my-frame'),
                get_iframe_by_link: inp('url','URL iframe',''),
                sleep: inp('seconds','–°–µ–∫—É–Ω–¥—ã','2','number'),
                random_sleep: inp('min_seconds','–ú–∏–Ω. —Å–µ–∫—É–Ω–¥—ã','1','number') + inp('max_seconds','–ú–∞–∫—Å. —Å–µ–∫—É–Ω–¥—ã','3','number'),
                wait_for_element: inp('selector','–°–µ–ª–µ–∫—Ç–æ—Ä','#element') + inp('seconds','Timeout (—Å–µ–∫)','30','number'),
                wait_for_navigation: inp('seconds','Timeout (—Å–µ–∫)','30','number'),
                fetch_get: inp('url','URL','https://api.example.com/data'),
                fetch_post: inp('url','URL','https://api.example.com/data') + inp('params','–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (JSON)','{"key":"value"}','textarea'),
            };

            c.innerHTML = forms[at] || '<p class="text-muted text-center">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è ‚Äî –Ω–∞–∂–º–∏—Ç–µ ¬´–í—ã–ø–æ–ª–Ω–∏—Ç—å¬ª</p>';
        }

        async function executeAction() {
            const sessionId = document.getElementById('action-session').value;
            const actionType = document.getElementById('action-type').value;
            if (!sessionId || !actionType) { showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Å—Å–∏—é –∏ –¥–µ–π—Å—Ç–≤–∏–µ', 'error'); return; }

            const payload = { action: actionType };

            // Collect parameters from visible inputs
            const fields = ['url','selector','text','value','attribute','script','save_as',
                            'cookies','cookies_text','tab_index','seconds','min_seconds','max_seconds','params'];
            let parseError = false;
            fields.forEach(f => {
                if (parseError) return;
                const el = document.getElementById('param-' + f);
                if (!el) return;
                let v = el.value.trim();
                if (!v) return;
                if (['cookies','params'].includes(f)) {
                    try { v = JSON.parse(v); } catch { showNotification('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: ' + f, 'error'); parseError = true; return; }
                }
                if (['tab_index','seconds','min_seconds','max_seconds'].includes(f)) v = parseFloat(v);
                payload[f] = v;
            });
            if (parseError) return;

            try {
                const r = await fetch(`${API}/actions/${sessionId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await r.json();
                document.getElementById('action-result').classList.remove('hidden');
                document.getElementById('action-result-content').textContent = JSON.stringify(result, null, 2);
                if (r.ok) showNotification('–î–µ–π—Å—Ç–≤–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ', 'success');
                else showNotification('–û—à–∏–±–∫–∞: ' + (result.detail || result.error || ''), 'error');
            } catch (e) {
                console.error('Error executing action:', e);
                showNotification('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è', 'error');
            }
        }

        // ============ SCRIPTS ============
        async function loadServerScripts() {
            try {
                const r = await fetch(`${API}/scripts`);
                const data = await r.json();
                serverScripts = data.scripts || [];
                renderScripts();
            } catch (e) {
                console.error('Error loading scripts:', e);
            }
        }

        function renderScripts() {
            const c = document.getElementById('saved-scripts');
            if (!serverScripts.length) {
                c.innerHTML = '<p class="text-muted text-center" style="padding:20px">–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤</p>';
                return;
            }
            c.innerHTML = serverScripts.map(s => {
                const script = s.script || {};
                const stepsCount = (script.steps || []).length;
                return `<div class="script-item">
                    <div class="meta">
                        <h4>${script.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</h4>
                        <p>ID: ${s.script_id} ¬∑ ${stepsCount} —à–∞–≥–æ–≤ ¬∑ ${new Date(s.created_at).toLocaleDateString('ru-RU')}</p>
                    </div>
                    <div class="btns">
                        <button class="btn btn-secondary btn-sm" onclick="loadScript('${s.script_id}')">üìÇ</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteScript('${s.script_id}')">üóë</button>
                    </div>
                </div>`;
            }).join('');
        }

        function showNewScriptForm() {
            currentEditScriptId = null;
            document.getElementById('script-name').value = '';
            document.getElementById('script-description').value = '';
            document.getElementById('script-editor').value = '';
        }

        async function saveScript() {
            const name = document.getElementById('script-name').value.trim();
            const description = document.getElementById('script-description').value.trim();
            const editorContent = document.getElementById('script-editor').value.trim();
            if (!name || !editorContent) { showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∫—Ä–∏–ø—Ç–∞', 'error'); return; }

            let steps;
            try { steps = JSON.parse(editorContent); } catch { showNotification('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON', 'error'); return; }

            const body = { name, description: description || null, steps: Array.isArray(steps) ? steps : [steps], variables: {} };

            try {
                let r;
                if (currentEditScriptId) {
                    r = await fetch(`${API}/scripts/${currentEditScriptId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                } else {
                    r = await fetch(`${API}/scripts`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                }
                if (r.ok) {
                    showNotification(currentEditScriptId ? '–°–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª—ë–Ω' : '–°–∫—Ä–∏–ø—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω', 'success');
                    await loadServerScripts();
                } else {
                    const err = await r.json();
                    showNotification('–û—à–∏–±–∫–∞: ' + (err.detail || ''), 'error');
                }
            } catch (e) {
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞', 'error');
            }
        }

        async function loadScript(scriptId) {
            try {
                const r = await fetch(`${API}/scripts/${scriptId}`);
                const data = await r.json();
                const script = data.script || data;
                currentEditScriptId = scriptId;
                document.getElementById('script-name').value = script.name || '';
                document.getElementById('script-description').value = script.description || '';
                document.getElementById('script-editor').value = JSON.stringify(script.steps || [], null, 2);
                showNotification('–°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä', 'success');
            } catch {
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞', 'error');
            }
        }

        async function deleteScript(scriptId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç?')) return;
            try {
                const r = await fetch(`${API}/scripts/${scriptId}`, { method: 'DELETE' });
                if (r.ok) {
                    showNotification('–°–∫—Ä–∏–ø—Ç —É–¥–∞–ª—ë–Ω', 'success');
                    if (currentEditScriptId === scriptId) currentEditScriptId = null;
                    await loadServerScripts();
                } else showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', 'error');
            } catch { showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞', 'error'); }
        }

        function clearScriptEditor() {
            currentEditScriptId = null;
            document.getElementById('script-name').value = '';
            document.getElementById('script-description').value = '';
            document.getElementById('script-editor').value = '';
        }

        async function runScript() {
            const sessionId = document.getElementById('script-session').value;
            const editorContent = document.getElementById('script-editor').value.trim();
            if (!editorContent) { showNotification('–í–≤–µ–¥–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç', 'error'); return; }

            let steps;
            try { steps = JSON.parse(editorContent); } catch { showNotification('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON', 'error'); return; }

            const body = {};
            if (currentEditScriptId) {
                body.script_id = currentEditScriptId;
            } else {
                body.script = {
                    name: document.getElementById('script-name').value.trim() || 'Inline script',
                    steps: Array.isArray(steps) ? steps : [steps],
                    variables: {}
                };
            }
            if (sessionId) body.session_id = sessionId;

            try {
                const r = await fetch(`${API}/scripts/run`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                const result = await r.json();
                document.getElementById('script-result').classList.remove('hidden');
                document.getElementById('script-result-content').textContent = JSON.stringify(result, null, 2);
                if (r.ok) showNotification('–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
                else showNotification('–û—à–∏–±–∫–∞: ' + (result.detail || ''), 'error');
            } catch (e) {
                console.error('Error running script:', e);
                showNotification('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞', 'error');
            }
        }

        // ============ AI AGENT ============
        async function runAIAgent() {
            const sessionId = document.getElementById('ai-session').value;
            const goal = document.getElementById('ai-goal').value.trim();
            const maxSteps = parseInt(document.getElementById('ai-max-steps').value);
            if (!sessionId || !goal) { showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Å—Å–∏—é –∏ –≤–≤–µ–¥–∏—Ç–µ —Ü–µ–ª—å', 'error'); return; }

            document.getElementById('ai-conversation').classList.remove('hidden');
            document.getElementById('ai-transcript').classList.remove('hidden');
            document.getElementById('ai-final-result').classList.remove('hidden');
            document.getElementById('ai-conversation-content').innerHTML = '<p class="text-muted">–ó–∞–ø—É—Å–∫ AI –∞–≥–µ–Ω—Ç–∞...</p>';
            document.getElementById('ai-transcript-content').innerHTML = '';
            document.getElementById('ai-final-result-content').textContent = '';

            try {
                const r = await fetch(`${API}/ai/run`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ session_id: sessionId, goal, max_steps: maxSteps })
                });
                const result = await r.json();

                if (result.conversation) {
                    document.getElementById('ai-conversation-content').innerHTML = result.conversation.map(msg =>
                        `<div class="msg-bubble ${msg.role === 'user' ? 'msg-user' : 'msg-assistant'}">
                            <div class="msg-role">${msg.role === 'user' ? 'üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' : 'ü§ñ AI'}</div>
                            <div>${escapeHtml(msg.content)}</div>
                        </div>`
                    ).join('');
                }

                if (result.actions_taken) {
                    document.getElementById('ai-transcript-content').innerHTML = result.actions_taken.map((a, i) =>
                        `<div style="font-size:13px;padding:6px 10px;background:var(--bg-input);border-radius:6px;margin-bottom:4px">
                            <strong>${i + 1}.</strong> ${escapeHtml(a.action)} ${a.success ? '‚úÖ' : '‚ùå'}
                        </div>`
                    ).join('');
                }

                document.getElementById('ai-final-result-content').textContent = JSON.stringify(result, null, 2);
                if (r.ok && result.success) showNotification('AI –∞–≥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É', 'success');
                else showNotification('AI –∞–≥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–∞–º–∏', 'error');
            } catch (e) {
                console.error('Error running AI agent:', e);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ AI –∞–≥–µ–Ω—Ç–∞', 'error');
                document.getElementById('ai-conversation-content').innerHTML = `<p style="color:var(--accent)">–û—à–∏–±–∫–∞: ${escapeHtml(e.message)}</p>`;
            }
        }

        // ============ AI SETTINGS ============
        async function loadAISettings() {
            try {
                const r = await fetch(`${API}/ai/config`);
                const data = await r.json();
                if (data.config) {
                    document.getElementById('ai-endpoint').value = data.config.endpoint || 'http://localhost:1234/v1';
                    document.getElementById('ai-api-key').value = data.config.api_key || '';
                    document.getElementById('ai-enabled').checked = data.config.enabled !== false;
                    if (data.config.model) {
                        const sel = document.getElementById('ai-model');
                        sel.innerHTML = `<option value="${data.config.model}">${data.config.model}</option>`;
                        sel.value = data.config.model;
                    }
                }
            } catch (e) {
                console.error('Error loading AI settings:', e);
            }
        }

        async function saveAISettings() {
            const body = {
                endpoint: document.getElementById('ai-endpoint').value,
                model: document.getElementById('ai-model').value,
                api_key: document.getElementById('ai-api-key').value || null,
                enabled: document.getElementById('ai-enabled').checked
            };
            try {
                const r = await fetch(`${API}/ai/config`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                if (r.ok) showSettingsStatus('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ', 'success');
                else showSettingsStatus('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
            } catch {
                showSettingsStatus('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'error');
            }
        }

        async function fetchModels() {
            const endpoint = document.getElementById('ai-endpoint').value;
            const apiKey = document.getElementById('ai-api-key').value || null;
            if (!endpoint) { showSettingsStatus('–í–≤–µ–¥–∏—Ç–µ AI endpoint', 'error'); return; }

            try {
                const r = await fetch(`${API}/ai/models`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ endpoint, api_key: apiKey })
                });
                const data = await r.json();
                const models = data.models || [];
                const sel = document.getElementById('ai-model');
                if (models.length) {
                    sel.innerHTML = models.map(m => {
                        const id = typeof m === 'string' ? m : m.id;
                        return `<option value="${id}">${id}</option>`;
                    }).join('');
                    showSettingsStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${models.length} –º–æ–¥–µ–ª–µ–π`, 'success');
                } else {
                    showSettingsStatus('–ú–æ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
                }
            } catch (e) {
                console.error('Error fetching models:', e);
                showSettingsStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ endpoint.', 'error');
            }
        }

        function showSettingsStatus(message, type) {
            const el = document.getElementById('settings-status');
            el.textContent = message;
            el.style.background = type === 'success' ? 'rgba(46,160,67,.15)' : 'rgba(185,28,28,.15)';
            el.style.color = type === 'success' ? '#3fb950' : '#ff4444';
            el.classList.remove('hidden');
            setTimeout(() => el.classList.add('hidden'), 4000);
        }

        // ============ UTILS ============
        function escapeHtml(text) {
            const d = document.createElement('div');
            d.textContent = text || '';
            return d.innerHTML;
        }
    </script>
</body>
</html>
